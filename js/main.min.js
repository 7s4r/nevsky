document.getElementById("year").textContent=(new Date).getFullYear();const btn=document.getElementById("menuBtn"),mobileMenu=document.getElementById("mobileMenu");btn?.addEventListener("click",()=>mobileMenu.classList.toggle("hidden")),mobileMenu?.querySelectorAll("a").forEach(e=>e.addEventListener("click",()=>mobileMenu.classList.add("hidden")));const header=document.getElementById("siteHeader"),onScroll=()=>{const e=window.scrollY>10;header.classList.toggle("scrolled",e)};window.addEventListener("scroll",onScroll),onScroll();const title=document.getElementById("calendarTitle"),grid=document.getElementById("calendarGrid"),prev=document.getElementById("prevMonth"),next=document.getElementById("nextMonth");let current=new Date;function getLangFromUrl(){try{const e=(new URLSearchParams(window.location.search).get("lang")||"").toLowerCase();return"fr"===e||"ru"===e?e:null}catch(e){return null}}function setLangParamInUrl(e){try{const t=new URL(window.location.href);t.searchParams.set("lang",e),window.history.replaceState({},"",t)}catch(e){}}current.setDate(1);let currentLang=getLangFromUrl()||localStorage.getItem("lang")||"fr";function formatMonthYear(e){return e.toLocaleDateString("ru"===currentLang?"ru-RU":"fr-FR",{month:"long",year:"numeric"}).replace(/^./,e=>e.toUpperCase())}function buildCalendar(e){grid.innerHTML="",title.textContent=formatMonthYear(e);const t=(new Date(e.getFullYear(),e.getMonth(),1).getDay()+6)%7,n=new Date(e.getFullYear(),e.getMonth()+1,0).getDate();for(let e=0;e<t;e++){const e=document.createElement("div");e.className="h-10 rounded-lg bg-transparent",grid.appendChild(e)}for(let t=1;t<=n;t++){const n=document.createElement("button");n.type="button",n.className="h-10 rounded-lg border border-slate-200 text-sm hover:bg-slate-50 focus:outline-none focus:ring-2 focus:ring-[#ffd615]",n.textContent=t,n.addEventListener("click",()=>alert(("ru"===currentLang?"Богослужения на ":"Offices pour le ")+t+" "+formatMonthYear(e)+" — (à compléter)")),grid.appendChild(n)}}setLangParamInUrl(currentLang),prev?.addEventListener("click",()=>{current.setMonth(current.getMonth()-1),buildCalendar(current)}),next?.addEventListener("click",()=>{current.setMonth(current.getMonth()+1),buildCalendar(current)}),buildCalendar(current);const translations=window.locales,t={fr:translations.fr,ru:translations.ru};function ensureAltLink(e){let t=document.querySelector(`link[rel="alternate"][hreflang="${e}"]`);return t||(t=document.createElement("link"),t.setAttribute("rel","alternate"),t.setAttribute("hreflang",e),document.head.appendChild(t)),t}function updateSeoTags(){const e="string"==typeof currentLang?currentLang:"fr";try{const t=document.querySelector('link[rel="canonical"]')||(()=>{const e=document.createElement("link");return e.setAttribute("rel","canonical"),document.head.appendChild(e),e})(),n=new URL(window.location.href);n.searchParams.set("lang",e),t.setAttribute("href",n.toString())}catch{}try{const e=new URL(window.location.origin+window.location.pathname),t=new URL(e);t.searchParams.set("lang","fr");const n=new URL(e);n.searchParams.set("lang","ru");const r=ensureAltLink("fr"),a=ensureAltLink("ru"),o=ensureAltLink("x-default");r.setAttribute("href",t.toString()),a.setAttribute("href",n.toString()),o.setAttribute("href",t.toString())}catch{}try{const n=t&&t[e]?t[e]:t&&t.fr||{},r=n["meta.title"]||document.title,a=n["meta.description"]||document.querySelector('meta[name="description"]')?.getAttribute("content")||"";document.title=r;let o=document.querySelector('meta[name="description"]');o||(o=document.createElement("meta"),o.setAttribute("name","description"),document.head.appendChild(o)),o.setAttribute("content",a);let c=document.querySelector('meta[property="og:title"]');c||(c=document.createElement("meta"),c.setAttribute("property","og:title"),document.head.appendChild(c)),c.setAttribute("content",r);let l=document.querySelector('meta[property="og:description"]');l||(l=document.createElement("meta"),l.setAttribute("property","og:description"),document.head.appendChild(l)),l.setAttribute("content",a);let s=document.querySelector('meta[property="og:url"]');s||(s=document.createElement("meta"),s.setAttribute("property","og:url"),document.head.appendChild(s)),s.setAttribute("content",new URL(window.location.href).toString())}catch{}}function applyI18n(){document.documentElement.lang="ru"===currentLang?"ru":"fr",document.title=t[currentLang]["meta.title"],document.querySelectorAll("[data-i18n]").forEach(e=>{const n=e.getAttribute("data-i18n");t[currentLang][n]&&(e.textContent=t[currentLang][n])}),syncLangSelect(),buildCalendar(current),updateSeoTags()}function setLang(e){currentLang=e,localStorage.setItem("lang",e),setLangParamInUrl(e),applyI18n()}currentLang=getLangFromUrl()||localStorage.getItem("lang")||currentLang||"fr";let langSelect=null;function syncLangSelect(){langSelect=document.getElementById("langSelect"),langSelect&&(langSelect.value=currentLang)}document.addEventListener("DOMContentLoaded",()=>{syncLangSelect(),langSelect?.addEventListener("change",e=>setLang(e.target.value))}),applyI18n();const contactForm=document.getElementById("contactForm"),contactResult=document.getElementById("contactResult"),newsletterForm=document.getElementById("newsletterForm"),newsletterResult=document.getElementById("newsletterResult");function displayFormResult(e,t,n){e.className="font-semibold "+("success"===t?"text-green-600":"error"===t?"text-red-600":"text-blue-600"),e.innerHTML=n,e.style.display=""}function sendFormData(e,t,n){const r=new FormData(e),a=Object.fromEntries(r),o=JSON.stringify(a);return fetch(t,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:o}).then(e=>{200==e.status?displayFormResult(n,"success",translations[currentLang]["contact.form.success"]||"Your message has been sent successfully."):displayFormResult(n,"error",translations[currentLang]["contact.form.error"]||"There was an error sending your message. Please try again.")}).catch(e=>{console.log(e),displayFormResult(n,"error",translations[currentLang]["contact.form.error"]||"Something went wrong!")})}contactForm.addEventListener("submit",function(e){e.preventDefault(),displayFormResult(contactResult,"info",translations[currentLang]["contact.form.wait"]||"Please wait..."),sendFormData(contactForm,"https://api.web3forms.com/submit",contactResult).then(function(){contactForm.reset(),setTimeout(()=>{contactResult.style.display="none"},3e3)})}),newsletterForm.addEventListener("submit",function(e){e.preventDefault(),displayFormResult(newsletterResult,"info",translations[currentLang]["contact.form.wait"]||"Please wait..."),sendFormData(newsletterForm,"https://api.web3forms.com/submit",newsletterResult).then(function(){newsletterForm.reset(),setTimeout(()=>{newsletterResult.style.display="none"},3e3)})});